"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var PropInput=function(){function t(e){return _classCallCheck(this,t),this._wrappedInput(e)}return _createClass(t,[{key:"_wrappedInput",value:function(e){var t=this._input(e);return this._wrap(t)}},{key:"_input",value:function(e){var n=this,r=Object.assign(document.createElement("input"),{name:e.name,value:e.value});return r.classList.add("custom-prop-input"),r.dataset.defaultValue=e.value,r.dataset.prop=JSON.stringify(e),["input","focus","blur","keydown"].forEach(function(t){r.addEventListener(t,function(e){return n["on_".concat(t)](e)})}),r.dispatchEvent(new Event("input")),r}},{key:"_wrap",value:function(e){var t=document.createElement("field");t.classList.add("field");var n=document.createElement("label");return n.innerText=this._normalizePropName(e.name),n.title=e.name,[n,e].forEach(function(e){return t.append(e)}),t}},{key:"_normalizePropName",value:function(e){var t=e.match(/(?:--[^-]*)/g);return e.replace(t,"").split("-").join(" ")}},{key:"on_input",value:function(e){var t=e.target;this._updateBorderColor(t),this._updateTheme(t)}},{key:"on_focus",value:function(e){var t=e.target;t.dataset.currentValue=t.value,t.setSelectionRange(0,t.value.length)}},{key:"on_blur",value:function(e){var t=e.target;t.removeAttribute("list"),this._updateDatalist(t),t.removeAttribute("data-current-value"),t.value.trim().length||(t.value=t.dataset.defaultValue,t.dispatchEvent(new Event("input")))}},{key:"on_keydown",value:function(e){var t=e.target;t.setAttribute("list","theme-editor-datalist");var n={38:"inc",187:"inc",40:"dec",189:"dec"};27===e.keyCode&&(t.value=t.dataset.currentValue),n[e.keyCode]&&this._increaseDecreaseNumbers(t,n[e.keyCode]),this._updateTheme(t),this._updateBorderColor(t)}},{key:"_updateTheme",value:function(e){var t=this;clearTimeout(e._typing);var n=e.value!==e.dataset.defaultValue;e.classList[n?"add":"remove"]("not-default"),e._typing=setTimeout(function(){e.classList.contains("not-default")?t.setCssProp(e.name,e.value):t.unsetCssProp(e.name)},100)}},{key:"_isCssColor",value:function(e){var t=(new Option).style;return t.color=e,!!t.color}},{key:"_updateBorderColor",value:function(e){var t=e.value;t&&(t.startsWith("var(--")||this._isCssColor(t))?e.style.borderColor=t:e.style.borderColor="#aaaaaa"}},{key:"_updateDatalist",value:function(e){var t=document.querySelector("#theme-editor form datalist");t.optionsIndex.includes(e.value)||t.addOption(e.value)}},{key:"_increaseDecreaseNumbers",value:function(e,n){var t=e.value.split(/(\d+)/).filter(function(e){return!!e});t=t.map(function(e){var t=Number(e);return t||0===Number(e)?"inc"==n?t+=1:1<=t?--t:t:e}),e.value=t.join(""),e.value.startsWith("#")&&7<e.value.length&&(e.value=e.value.substring(0,7))}},{key:"setCssProp",value:function(e,t){document.documentElement.style.setProperty(e,t)}},{key:"unsetCssProp",value:function(e){document.documentElement.style.removeProperty(e)}}]),t}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ThemeEditor=function(){function t(e){_classCallCheck(this,t),this.FORM=document.querySelector(e.form),this.CSS_CUSTOM_PROPS=e.propset,this.render()}return _createClass(t,[{key:"render",value:function(){var e=this._customPropsToInputs(this.CSS_CUSTOM_PROPS);this._renderPropsInputs(this.FORM,e),this.FORM.append(this._createPropsDataList()),this.FORM.addEventListener("submit",function(e){return e.preventDefault()}),this._addThemePreviewAction(".preview-theme"),this._addDownloadThemeAction(".download-theme"),this._addCssCustomPropsIndex("#proplist"),this._addResetAppBtnEvents(".reload-app"),this._addSearchPropBtnEvents("#search-custom-props")}},{key:"_createPropsDataList",value:function(){var n=Object.assign(document.createElement("datalist"),{id:"theme-editor-datalist",optionsIndex:[]});return n.addOption=function(e){if(e&&e.startsWith("--")&&(e="var(".concat(e,")")),e&&!n.optionsIndex.includes(e)){n.optionsIndex.push(e);var t=Object.assign(document.createElement("option"),{innerText:e});n.append(t)}},this.FORM.querySelectorAll("input").forEach(function(e){[e.name,e.value,e.dataset.defaultValue].forEach(function(e){n.addOption(e)})}),n}},{key:"_createPropInput",value:function(e){return new PropInput(e)}},{key:"_createHolder",value:function(){return document.createElement("div")}},{key:"_customPropsToInputs",value:function(e){var t=this;return e.map(function(e){return e.map(function(e){return t._createPropInput(e)})})}},{key:"_renderPropsInputs",value:function(n,e){var r=this;e.forEach(function(e){var t=r._createHolder();e.forEach(function(e){t.append(e)}),n.append(t)})}},{key:"_addThemePreviewAction",value:function(e){var t=document.getElementById("custom-theme-code-mirror"),n=this._initializeCodeMirror(t);document.querySelectorAll(e).forEach(function(e){e.addEventListener("click",function(e){var t=ThemeUtils.getCustomTheme();n.setValue(t),n.refresh()})})}},{key:"_addDownloadThemeAction",value:function(e){var r=this;document.querySelectorAll(e).forEach(function(e){e.addEventListener("click",function(e){var t=ThemeUtils.getCustomTheme(),n=r._slugify(document.querySelector('[name="plume-custom-theme-name"]').value||"untitled");r._saveFile("plume-theme-".concat(n,".css"),t)})})}},{key:"_initializeCodeMirror",value:function(e){var t=CodeMirror.fromTextArea(e,{mode:"css",readOnly:!0,lineNumbers:!0});return t.setSize("100%","100%"),t}},{key:"_slugify",value:function(e){return e.toString().toLowerCase().normalize("NFD").trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}},{key:"_saveFile",value:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:"data:attachment/text";if(null!==t&&navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([t],{type:r}),e);var a=document.createElement("a");a.style.diplay="none";var o=window.URL.createObjectURL(new Blob([t],{type:r}));a.setAttribute("href",o),a.setAttribute("download",e),document.body.append(a),a.click(),window.URL.revokeObjectURL(o),a.remove()}},{key:"_addCssCustomPropsIndex",value:function(r){r=document.querySelector(r),this.CSS_CUSTOM_PROPS.forEach(function(e){var n=document.createElement("div");e.forEach(function(e){var t=Object.assign(document.createElement("div"),{innerText:e.name});n.append(t),r.append(n)})})}},{key:"_addResetAppBtnEvents",value:function(e){document.querySelectorAll(e).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),ThemeUtils.reloadApp()})})}},{key:"_addSearchPropBtnEvents",value:function(t){var n=this;(t=document.querySelector(t)).addEventListener("input",function(e){e.preventDefault(),clearTimeout(t._TYPING),n.FORM.style.opacity=".5",t._TYPING=setTimeout(function(){n._filterInputsByQuery(t.value),n.FORM.style.opacity="1"},500)}),t.addEventListener("focus",function(){t.setSelectionRange(0,t.value.length)})}},{key:"_filterInputsByQuery",value:function(t){var n=this;this.FORM.classList.remove("searching"),this.FORM.querySelectorAll("input.custom-prop-input").forEach(function(e){e.classList.remove("keep"),e.parentElement.style.display="block"}),this.FORM.querySelectorAll(":scope > div").forEach(function(e){e.style.display="block"}),t.trim().length&&(this.FORM.querySelectorAll("input.custom-prop-input").forEach(function(e){n.FORM.classList.add("searching"),e.classList.remove("keep"),e.parentElement.style.display="none",0<[e.name,e.value,e.dataset.prop,e.dataset.defaultValue,e.parentElement.querySelector("label").innerText].join(" ").toUpperCase().indexOf(t.toUpperCase())&&(e.classList.add("keep"),e.parentElement.style.display="block")}),this.FORM.querySelectorAll(":scope > div").forEach(function(e){e.querySelectorAll(".keep").length||(e.style.display="none")}))}}]),t}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ThemeUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getStyleSheetArray",value:function(e,t){var n=document.getElementById(e),r=n?Array.from(n.sheet.rules||n.sheet.cssRules):void 0;return r&&t&&(r=this.filterBySelector(t,r)),r}},{key:"filterBySelector",value:function(t,e){return e.length?e.filter(function(e){return e.selectorText===t}):void 0}},{key:"getCustomPropsFromStr",value:function(e){return e.match(/(?:--[^;]*)/g).map(function(e){return{name:(t=e.split(":"))[0],value:t[1].replace(";","")};var t})}},{key:"getCustomPropsFromStyleSheet",value:function(e,t){var n=this,r=1<arguments.length&&void 0!==t?t:":root";return this.getStyleSheetArray(e,r).map(function(e){return n.getCustomPropsFromStr(e.cssText)})}},{key:"getCustomTheme",value:function(e){var t=!(0<arguments.length&&void 0!==e)||e,n=document.querySelector('[name="plume-custom-theme-scope"]').value||":root",r=document.documentElement.style.cssText;return r.indexOf("--pm-")<0?r="/* You didn't modified any default property. */":t&&(r=cssbeautify("".concat(n," { ").concat(r," }"),{indent:"  ",autosemicolon:!0})),r}},{key:"reloadApp",value:function(){window.history.pushState({},document.title,window.location.href.split("?")[0]),window.location.reload()}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ToggleSource=function(){function t(e){_classCallCheck(this,t),this.TRIGGER=document.querySelector(e.trigger),this.TARGETS=document.querySelectorAll(e.targets),this.CODEHOLDERS=[],this._init()}return _createClass(t,[{key:"_init",value:function(){this._addCodeMirrorOnTargets(),this._addTriggerClickListener()}},{key:"_addCodeMirrorOnTargets",value:function(){var a=this;this.TARGETS.forEach(function(e){var t=document.createElement("div");t.classList.add("el-ac-code-preview"),e.insertAdjacentElement("afterend",t);var n=document.createElement("textarea");n.value=e.innerHTML,t.append(n);var r=a._textareaToCodeMirror(n);a.CODEHOLDERS.push({$el:t,$cm:r})})}},{key:"_addTriggerClickListener",value:function(){var t=this;this.TRIGGER.addEventListener("click",function(e){e.preventDefault(),t.TRIGGER.classList.toggle("active"),t.CODEHOLDERS.forEach(function(e){e.$el.classList.toggle("visible"),e.$cm.refresh()})})}},{key:"_textareaToCodeMirror",value:function(e){var t=CodeMirror.fromTextArea(e,{mode:"htmlmixed",readOnly:!0,htmlMode:!0,lineNumbers:!0});return t.setSize("100%","100%"),t.setValue(e.value),t}}]),t}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var URLHandler=function(){function t(e){_classCallCheck(this,t),this.FORM=document.querySelector(e.form),this._init()}return _createClass(t,[{key:"_init",value:function(){this._loadState(),this._addInputListeners()}},{key:"_clearState",value:function(e){e&&console.warn("PLUME CSS WARN: A problem occurred while loading Plume Theme from URL data. Default theme loaded.\nError Ref: ".concat(e)),window.history.pushState({},document.title,window.location.href.split("?")[0])}},{key:"_addInputListeners",value:function(){var n=this;this.FORM.querySelectorAll("input").forEach(function(t){["input","keyup","blur"].forEach(function(e){t.addEventListener(e,function(){n._saveState()})})})}},{key:"_loadState",value:function(){try{var e=window.location.search.slice(1);if(e&&e.length){var t=this._decompress_str(e);t?this._loadFormData(t):this._clearState("Malformed theme string")}}catch(e){this._clearState(e)}}},{key:"_saveState",value:function(){if(document.querySelector(".not-default")){var e=this._serialize(this.FORM),t=this._compress_str(e);window.history.pushState({},document.title,"?".concat(t))}else this._clearState()}},{key:"_loadFormData",value:function(e){var n=this;decodeURIComponent(e).split("&").map(function(e){return{name:e.split("=")[0],value:e.split("=")[1]}}).forEach(function(e){if(e.name&&e.value){var t=n.FORM.querySelector('input[name="'.concat(e.name,'"]'));t.value=e.value,t.dispatchEvent(new Event("input"))}})}},{key:"_serialize",value:function(){var t=[];return this.FORM.querySelectorAll("input.static, input.not-default").forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")}},{key:"_compress_str",value:function(e){return LZString.compressToEncodedURIComponent(e)}},{key:"_decompress_str",value:function(e){return LZString.decompressFromEncodedURIComponent(e)}}]),t}();!function(){var r=document.querySelector("#premade-themes .premade-themes-list");[{name:"Default Dark",description:"Plume's default dark theme",palette:{primary:"#33b5e5",secondary:"#c03ae9",surface:"#222",text:"#fff"},urlQuery:"A4GwrgtgpgtAxmAzgFwPYRsgFlaMB2AhtALwAiUAZoWCMgKQBMADGYQE4DWAZKJLAhTpMOPIjipgUEvQDMAQXapUybjBjAMhYMBiIw7anAGoQqdjJZNZjW2o1admKAA9k8U+cvNrlP0A"},{name:"Sweet Carnival",description:"A pastel rounded theme",palette:{primary:"#90d2d8",secondary:"#f6a6b2",surface:"transparent",text:"#555"},urlQuery:"A4GwrgtgpgtAxmAzgFwPYRsgFlaMB2AhtALwDKA7lFMgKQBMADAMKEBO+AlgG6EgBkoSLAQp0mHHkRxUwKCVoBmAIJtUqZPxgxgGYG04R2AT3ioQqNgvqKAnIwAm9BwA4tOjIigz8Dk2YsrBkUAMwA2QjCAI3p3XQDLGEQwODgoRERrO1tU21s4jBlAmCg2NSCbEJCAdhqQgoS2GAp2LnwAcyyqp1qGwmBgJLA2EMI0xpJkNkJ8RGB2KHxNbXj+wfa1MF8JqZm5haW+gcwoAA9kCeCAVhuGqLBkNHwYCE5nnE52rGQSABYXYCnO4PJ4wKKWBylGDTBycJAkehXQENN7AB4wD5fH7-ZErDCo9HgtiQpowuGZACMv0BDEYjAa+hEqEhYIhULJ8KpNKY9LxOjYTJZUTGAGsNqgtg5LjZIg4og56nzGdLFKrFEA"}].forEach(function(t){var e=document.createElement("li"),n='\n      <a href="?'.concat(t.urlQuery,'">\n        <span class="custom-theme-list-item__name">').concat(t.name,'</span>\n        <span class="custom-theme-list-item__description">').concat(t.description,'</span>\n        <span class="custom-theme-list-item__palette">\n          ').concat(Array.from(Object.keys(t.palette).map(function(e){return'<span title="'.concat(e,' color" class="color-').concat(e,'" style="background-color:').concat(t.palette[e],'"></span>')})).join(""),"\n        </span>\n      </a>\n    ");e.insertAdjacentHTML("beforeend",n),e.classList.add("custom-theme-list-item"),r.append(e)})}(),function(){var e=ThemeUtils.getCustomPropsFromStyleSheet("plume",":root");new ThemeEditor({propset:e,form:"#theme-editor form"}),new URLHandler({form:"#theme-editor form"}),new ToggleSource({trigger:"#toggle-source",targets:"[data-toggle-source]"})}();